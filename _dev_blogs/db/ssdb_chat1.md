
2016/9/29 16:36:26
苛（百业网） 2016/9/29 16:36:26
multi_get 结果是一个包过来的吗？
2016/9/29 16:57:03
苛（百业网） 2016/9/29 16:57:03
找我私聊者踢
对于 multi 用法, 会一次收到多个报文, 解析完一个之后, 将解析完的数据从 recv_buf 中清除, 继续解析下一个.

作者的这个说法，我觉得原来解析程序可能存在bug 丢失后面数据问题。
size\ndata\n\nsize\ndata\n\n    一次读11个字节，原解析程序就会丢弃后面一段结果
 private function recv() {
        $this->step = self::STEP_SIZE;
        while (true) {
            $ret = $this->parse();
            if ($ret === null) {
                try {
                    $data = @fread($this->sock, 1024 * 1024);
                    if ($this->debug) {
                        echo '< ' . str_replace(array("\r", "\n"), array('\r', '\n'), $data) . "\n";
                    }
                } catch (Exception $e) {
                    $data = '';
                }
                if ($data === false || $data === '') {
                    if (feof($this->sock)) {
                        $this->close();
                        throw new SSDBException('Connection lost');
                    } else {
                        throw new SSDBTimeoutException('Connection timeout');
                    }
                }
                $this->recv_buf .= $data;
#				echo "read " . strlen($data) . " total: " . strlen($this->recv_buf) . "\n";
            } else {
                return $ret;
            }
        }
    }
2016/9/29 16:57:37
找我私聊者踢 2016/9/29 16:57:37
刚才说错, multi => batch
找我私聊者踢 2016/9/29 16:58:10
指 req, req, resp, resp, 不是 req, resp 请求响应模式.
找我私聊者踢 2016/9/29 16:58:35
先发 n 个请求, 然后再读取 n 个响应
苛（百业网） 2016/9/29 16:58:45
哦。
找我私聊者踢 2016/9/29 16:58:55
你需要考虑所谓的"粘包"
Wendal~兽 2016/9/29 16:59:35
req req 。。。。。 resp resp

req是get操作的话就会出错
2016/9/29 17:10:58
找我私聊者踢 2016/9/29 17:10:58
处理 tcp socket 时, 最容易犯的错就是未正确的处理"粘包"和"分包".
2016/10/1 17:41:41
风从海面吹过来 2016/10/1 17:41:41
老大 请问hashmap 可以单独一个hashmap 当成mysql table  那样用么 就是存成百上千万对kv
2016/10/1 18:04:42
聂 2016/10/1 18:04:42
可以。再说了，自己动手存几千万个kv不就知道了
2016/10/1 18:07:42
木头人 2016/10/1 18:07:42
几行代码就出来了，自己存个几百GB数据试试
2016/10/1 18:08:47
可西哥 2016/10/1 18:08:47
就是这么用的
乖 2016/10/1 18:08:55
几百G，硬盘里放得下吗
木头人 2016/10/1 18:09:50
几百G的data...
乖 2016/10/1 18:10:23
1t的硬盘320
聂 2016/10/1 18:10:38

2016/10/1 18:17:57
风从海面吹过来 2016/10/1 18:17:57
那我的小电影岂不是得删了 我考虑考虑
2016/10/1 18:23:24
聂 2016/10/1 18:23:24
自己动手
2016/10/2 14:01:35
lonsoft 2016/10/2 14:01:35

lonsoft 2016/10/2 14:01:45
在2012的IE 无法登陆
lonsoft 2016/10/2 14:02:39
请问怎么班？
lonsoft 2016/10/2 14:02:43
浏览器编码问题？
2016/10/2 20:07:58
找我私聊者踢 2016/10/2 20:07:58
@lonsoft 用火狐
2016/10/2 21:49:19
lonsoft 2016/10/2 21:49:19
谢谢

21:23:43
大管家 2016/10/7 21:23:43
群里面，有木有im的聊天记录存储，用ssdb的
张闳 2016/10/7 21:25:40
SSDB虽然可以存IM聊天记录，但不便于检索。我们是用MongoDB保存
21:27:48
大管家 2016/10/7 21:27:48
还好吧.就是zset.跟hset多了点，不知道这两个东西多会不会影响ssdb的性能
心静澄明 2016/10/7 21:28:20
mongodb性能行吗
心静澄明 2016/10/7 21:28:31
一条聊天记录存一下吗
张闳 2016/10/7 21:29:16
Mongodb的性能够用的，而且本身支持集群与分片
21:29:49
张闳 2016/10/7 21:29:49
要看你的IM聊天的量了，当然如果是QQ或微信这样的量级那肯定是不行的
大管家 2016/10/7 21:31:14
ssdb比较灵活，mongodb.还得用json
大管家 2016/10/7 21:31:19
比较不方便
21:32:16
张闳 2016/10/7 21:32:16

张闳 2016/10/7 21:32:39
当你要做检索的时候，就发现SSDB、Redis的不足了
Wendal~兽 2016/10/7 21:33:28
mongodb查询很好很强大，各取所长嘛
大管家 2016/10/7 21:33:58
im的账号都用数字，检索还好啦
21:34:48
大管家 2016/10/7 21:34:48
用zset做索引
Wendal~兽 2016/10/7 21:34:57
查含有某个词的聊天记录，ssdb/redis怎样查？
大管家 2016/10/7 21:35:38
im没有这种需求吧
21:36:11
Wendal~兽 2016/10/7 21:36:11
没用过qq的聊天记录查询？
张闳 2016/10/7 21:36:17
你没在QQ、微信里面搜索过聊天记录？
“1”（壹） 2016/10/7 21:36:49
一般检索是个单独的服务吧
张闳 2016/10/7 21:37:36
不敢是不是单独服务，数据总要存储吧，存储在SSDB里的数据怎么做检索？
Wendal~兽 2016/10/7 21:37:52
kv数据库，针对内容的条件查询，基本无解。。。
21:38:34
“1”（壹） 2016/10/7 21:38:34
其他服务根据内容得到k，再来kv中查
大管家 2016/10/7 21:38:37
这个看设计
“1”（壹） 2016/10/7 21:38:43
比如倒排索引
大管家 2016/10/7 21:38:51
有些逻辑放客户端
Wendal~兽 2016/10/7 21:39:45
第三方服务啥都能补充完整，但kv数据库本地就是查不了
大管家 2016/10/7 21:40:18
ssdb服务器，获取个人的全部聊天记录很容易
21:41:40
大管家 2016/10/7 21:41:40
相信这方面的性能比mongodb来得快
Wendal~兽 2016/10/7 21:43:08
基于什么的推断？
张闳 2016/10/7 21:43:20
SSDB作为缓存数据库，直接KV存取还是不错的，不过我这边最后还是转回到Redis上
21:44:17
大管家 2016/10/7 21:44:17
mongo内存占用率高
Wendal~兽 2016/10/7 21:44:23
要是11个客户端各取1gb聊天数据库，那第11个人就要等另外10个取完了才能开始读取，mongodb就没这个问题
Wendal~兽 2016/10/7 21:44:40
mongodb的设计就是要吃完全部内存和cpu呢
大管家 2016/10/7 21:45:47
@389627265 ，可以单独设计一个服务去跟ssdb打交道
21:48:28
张闳 2016/10/7 21:48:28
SSDB适合离散小数据量缓存存储，我们这边把用户Session、Token、用户基本信息之类经常性查询，但不要求事务性修改的数据扔在SSDB中，有事务性要求的数据放MySQL，日志型大数据量的数据放在MongoDB，需要全文检索的导入到ES或阿里OpenSearch
21:54:22
大管家 2016/10/7 21:54:22
学习了～
21:57:54
张闳 2016/10/7 21:57:54
多种类型的数据库组合使用，不迷信于单一某种数据库全能。尺有所短，寸有所长
22:00:10
大管家 2016/10/7 22:00:10

